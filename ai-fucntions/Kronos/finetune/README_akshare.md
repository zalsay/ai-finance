# AkShareæ•°æ®é¢„å¤„ç†æ–¹æ¡ˆ

åŸºäºakshareåº“å®ç°çš„é‡‘èæ•°æ®é¢„å¤„ç†æ–¹æ¡ˆï¼Œä¸qlibæ•°æ®é¢„å¤„ç†åŠŸèƒ½å®Œå…¨å…¼å®¹ã€‚

## ğŸ“‹ ç›®å½•

- [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
- [æ–‡ä»¶è¯´æ˜](#æ–‡ä»¶è¯´æ˜)
- [å®‰è£…ä¾èµ–](#å®‰è£…ä¾èµ–)
- [ä½¿ç”¨æ–¹æ³•](#ä½¿ç”¨æ–¹æ³•)
- [æŠ€æœ¯ç»†èŠ‚](#æŠ€æœ¯ç»†èŠ‚)
- [æ•°æ®æ ¼å¼è¯´æ˜](#æ•°æ®æ ¼å¼è¯´æ˜)
- [å¼‚å¸¸å¤„ç†](#å¼‚å¸¸å¤„ç†)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- âœ… **å®Œæ•´æ•°æ®è·å–æµç¨‹**ï¼šä»akshareè·å–Aè‚¡å†å²æ•°æ®
- âœ… **æ•°æ®æ¸…æ´—å’Œé¢„å¤„ç†**ï¼šç¼ºå¤±å€¼å¤„ç†ã€æ•°æ®ç±»å‹è½¬æ¢
- âœ… **ç‰¹å¾å·¥ç¨‹**ï¼šè®¡ç®—æŠ€æœ¯æŒ‡æ ‡å’Œè¡ç”Ÿç‰¹å¾
- âœ… **æ ¼å¼å…¼å®¹**ï¼šä¸qlibæ•°æ®æ ¼å¼å®Œå…¨ä¸€è‡´
- âœ… **æ•°æ®é›†åˆ†å‰²**ï¼šè®­ç»ƒé›†/éªŒè¯é›†/æµ‹è¯•é›†è‡ªåŠ¨åˆ†å‰²
- âœ… **å¼‚å¸¸å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- âœ… **æ—¥å¿—è®°å½•**ï¼šè¯¦ç»†çš„å¤„ç†æ—¥å¿—å’Œè¿›åº¦è·Ÿè¸ª

### æŠ€æœ¯ä¼˜åŠ¿
- ğŸ”„ **ä¸qlibå…¼å®¹**ï¼šè¾“å‡ºæ ¼å¼ä¸qlibå®Œå…¨ä¸€è‡´
- ğŸ“Š **æ•°æ®è´¨é‡ä¿è¯**ï¼šå¤šå±‚æ•°æ®éªŒè¯å’Œæ¸…æ´—
- âš¡ **é«˜æ•ˆå¤„ç†**ï¼šæ‰¹é‡å¤„ç†å’Œè¿›åº¦æ˜¾ç¤º
- ğŸ›¡ï¸ **ç¨³å®šå¯é **ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
- ğŸ“ **è¯¦ç»†æ³¨é‡Š**ï¼šæ¯ä¸ªå…³é”®æ­¥éª¤éƒ½æœ‰ä¸­æ–‡æ³¨é‡Š

## ğŸ“ æ–‡ä»¶è¯´æ˜

### ä¸»è¦æ–‡ä»¶

| æ–‡ä»¶å | åŠŸèƒ½æè¿° | ä½¿ç”¨åœºæ™¯ |
|--------|----------|----------|
| `akshare_data_preprocess.py` | å®Œæ•´ç‰ˆæ•°æ®é¢„å¤„ç†å™¨ | ç”Ÿäº§ç¯å¢ƒï¼Œå®Œæ•´æ•°æ®å¤„ç† |
| `akshare_data_preprocess_simple.py` | ç®€åŒ–ç‰ˆæ•°æ®é¢„å¤„ç†å™¨ | å¿«é€Ÿæµ‹è¯•ï¼ŒåŸå‹å¼€å‘ |
| `test_akshare_vs_qlib.py` | æ•°æ®å¯¹æ¯”æµ‹è¯•å·¥å…· | éªŒè¯æ•°æ®ä¸€è‡´æ€§ |
| `README_akshare.md` | ä½¿ç”¨è¯´æ˜æ–‡æ¡£ | å­¦ä¹ å’Œå‚è€ƒ |

### è¾“å‡ºæ–‡ä»¶

| æ–‡ä»¶å | å†…å®¹æè¿° | æ ¼å¼ |
|--------|----------|------|
| `processed_data_akshare_simple.pkl` | ç®€åŒ–ç‰ˆå¤„ç†ç»“æœ | pickle |
| `akshare/processed_datasets/train_data.pkl` | è®­ç»ƒé›†æ•°æ® | pickle |
| `akshare/processed_datasets/val_data.pkl` | éªŒè¯é›†æ•°æ® | pickle |
| `akshare/processed_datasets/test_data.pkl` | æµ‹è¯•é›†æ•°æ® | pickle |
| `akshare_data_preprocess.log` | å¤„ç†æ—¥å¿— | æ–‡æœ¬ |

## ğŸ”§ å®‰è£…ä¾èµ–

### å¿…éœ€ä¾èµ–

```bash
# å®‰è£…akshare
pip install akshare

# å®‰è£…å…¶ä»–ä¾èµ–
pip install pandas numpy tqdm
```

### å¯é€‰ä¾èµ–

```bash
# å¦‚æœéœ€è¦å¯¹æ¯”qlibæ•°æ®
pip install qlib
```

### ä¾èµ–ç‰ˆæœ¬å»ºè®®

```
akshare >= 1.9.0
pandas >= 1.3.0
numpy >= 1.20.0
tqdm >= 4.60.0
```

## ğŸ¯ ä½¿ç”¨æ–¹æ³•

### 1. å¿«é€Ÿå¼€å§‹ï¼ˆç®€åŒ–ç‰ˆï¼‰

```bash
# è¿è¡Œç®€åŒ–ç‰ˆæ•°æ®é¢„å¤„ç†
python akshare_data_preprocess_simple.py
```

**è¾“å‡ºç»“æœï¼š**
- `processed_data_akshare_simple.pkl`ï¼šåŒ…å«3ä¸ªè‚¡ç¥¨çš„å¤„ç†ç»“æœ
- å¤„ç†æ—¶é—´ï¼šçº¦2-5åˆ†é’Ÿ
- æ•°æ®èŒƒå›´ï¼š2020å¹´1-3æœˆ

### 2. å®Œæ•´æ•°æ®å¤„ç†

```bash
# è¿è¡Œå®Œæ•´ç‰ˆæ•°æ®é¢„å¤„ç†
python akshare_data_preprocess.py
```

**è¾“å‡ºç»“æœï¼š**
- è®­ç»ƒé›†ã€éªŒè¯é›†ã€æµ‹è¯•é›†æ–‡ä»¶
- å®Œæ•´çš„å¤„ç†æ—¥å¿—
- æ•°æ®èŒƒå›´ï¼š2010-2025å¹´

### 3. æ•°æ®éªŒè¯å’Œå¯¹æ¯”

```bash
# è¿è¡Œæ•°æ®å¯¹æ¯”æµ‹è¯•
python test_akshare_vs_qlib.py
```

**åŠŸèƒ½ï¼š**
- éªŒè¯æ•°æ®æ ¼å¼ä¸€è‡´æ€§
- å¯¹æ¯”akshareå’Œqlibæ•°æ®
- ç”Ÿæˆè¯¦ç»†å¯¹æ¯”æŠ¥å‘Š

### 4. è‡ªå®šä¹‰é…ç½®

#### ä¿®æ”¹è‚¡ç¥¨åˆ—è¡¨

```python
# åœ¨akshare_data_preprocess.pyä¸­ä¿®æ”¹
self.instrument = ['600000', '600036', '600519']  # è‡ªå®šä¹‰è‚¡ç¥¨ä»£ç 
```

#### ä¿®æ”¹æ—¶é—´èŒƒå›´

```python
# ä¿®æ”¹æ•°æ®æ—¶é—´èŒƒå›´
self.dataset_begin_time = "2015-01-01"
self.dataset_end_time = "2023-12-31"
```

#### ä¿®æ”¹ç‰¹å¾åˆ—è¡¨

```python
# ä¿®æ”¹è¾“å‡ºç‰¹å¾
self.feature_list = ['open', 'high', 'low', 'close', 'vol', 'amt', 'vwap']
```

## ğŸ”¬ æŠ€æœ¯ç»†èŠ‚

### æ•°æ®è·å–æµç¨‹

```python
# 1. ä½¿ç”¨akshareè·å–è‚¡ç¥¨æ•°æ®
stock_data = ak.stock_zh_a_hist(
    symbol=symbol,           # è‚¡ç¥¨ä»£ç ï¼ˆå¦‚'600000'ï¼‰
    period="daily",          # æ—¥é¢‘æ•°æ®
    start_date="20200101",   # å¼€å§‹æ—¥æœŸï¼ˆYYYYMMDDæ ¼å¼ï¼‰
    end_date="20201231",     # ç»“æŸæ—¥æœŸï¼ˆYYYYMMDDæ ¼å¼ï¼‰
    adjust="qfq"             # å‰å¤æƒå¤„ç†
)
```

**akshareæ¥å£å‚æ•°è¯´æ˜ï¼š**
- `symbol`: è‚¡ç¥¨ä»£ç ï¼Œä½¿ç”¨6ä½æ•°å­—æ ¼å¼ï¼ˆå¦‚600000ï¼‰
- `period`: æ•°æ®é¢‘ç‡ï¼Œ"daily"è¡¨ç¤ºæ—¥çº¿æ•°æ®
- `start_date/end_date`: æ—¶é—´èŒƒå›´ï¼Œå¿…é¡»ä½¿ç”¨YYYYMMDDæ ¼å¼
- `adjust`: å¤æƒæ–¹å¼
  - `"qfq"`: å‰å¤æƒï¼Œæ¶ˆé™¤åˆ†çº¢é€è‚¡å¯¹ä»·æ ¼çš„å½±å“
  - `"hfq"`: åå¤æƒ
  - `""`: ä¸å¤æƒ

### æ•°æ®è½¬æ¢é€»è¾‘

#### 1. åˆ—åæ˜ å°„

```python
# akshareè¿”å›çš„ä¸­æ–‡åˆ—å -> æ ‡å‡†è‹±æ–‡åˆ—å
column_mapping = {
    'æ—¥æœŸ': 'datetime',    # äº¤æ˜“æ—¥æœŸ
    'å¼€ç›˜': 'open',        # å¼€ç›˜ä»·ï¼ˆå…ƒï¼‰
    'æ”¶ç›˜': 'close',       # æ”¶ç›˜ä»·ï¼ˆå…ƒï¼‰
    'æœ€é«˜': 'high',        # æœ€é«˜ä»·ï¼ˆå…ƒï¼‰
    'æœ€ä½': 'low',         # æœ€ä½ä»·ï¼ˆå…ƒï¼‰
    'æˆäº¤é‡': 'volume',    # æˆäº¤é‡ï¼ˆæ‰‹ï¼Œ1æ‰‹=100è‚¡ï¼‰
    'æˆäº¤é¢': 'amount'     # æˆäº¤é¢ï¼ˆå…ƒï¼‰
}
```

#### 2. è¡ç”Ÿç‰¹å¾è®¡ç®—

```python
# volç‰¹å¾ï¼šæˆäº¤é‡
result_df['vol'] = result_df['volume']

# amtç‰¹å¾ï¼šæˆäº¤é¢
if 'amount' in result_df.columns:
    # ç›´æ¥ä½¿ç”¨akshareæä¾›çš„æˆäº¤é¢
    result_df['amt'] = result_df['amount']
else:
    # ä½¿ç”¨OHLCå‡ä»·ä¼°ç®—æˆäº¤é¢
    avg_price = (result_df['open'] + result_df['high'] + 
                result_df['low'] + result_df['close']) / 4
    result_df['amt'] = avg_price * result_df['vol']
```

**è®¡ç®—è¯´æ˜ï¼š**
- `vol`: ç›´æ¥ä½¿ç”¨æˆäº¤é‡æ•°æ®
- `amt`: ä¼˜å…ˆä½¿ç”¨akshareçš„æˆäº¤é¢ï¼Œå¦‚æœæ²¡æœ‰åˆ™ç”¨OHLCå‡ä»·ä¹˜ä»¥æˆäº¤é‡ä¼°ç®—
- è¿™ç§è®¡ç®—æ–¹å¼ä¸qlibä¿æŒä¸€è‡´

#### 3. æ•°æ®æ¸…æ´—æµç¨‹

```python
# 1. ç¼ºå¤±å€¼å¤„ç†
stock_df = stock_df.dropna()  # åˆ é™¤åŒ…å«NaNçš„è¡Œ

# 2. æ•°æ®ç±»å‹è½¬æ¢
numeric_columns = ['open', 'close', 'high', 'low', 'volume']
for col in numeric_columns:
    stock_df[col] = pd.to_numeric(stock_df[col], errors='coerce')

# 3. æ•°æ®é•¿åº¦éªŒè¯
min_required_length = lookback_window + predict_window + 1
if len(stock_df) < min_required_length:
    # è·³è¿‡æ•°æ®ä¸è¶³çš„è‚¡ç¥¨
    continue
```

### æ—¶é—´å¤„ç†æœºåˆ¶

#### 1. ç¼“å†²æ—¶é—´è®¡ç®—

```python
# å‘å‰æ‰©å±•ï¼šä¸ºlookback_windowæä¾›è¶³å¤Ÿå†å²æ•°æ®
buffer_start = start_date - timedelta(days=lookback_window + 30)

# å‘åæ‰©å±•ï¼šä¸ºpredict_windowæä¾›æœªæ¥æ•°æ®
buffer_end = end_date + timedelta(days=predict_window + 30)
```

#### 2. æ•°æ®é›†åˆ†å‰²

```python
# æ—¶é—´èŒƒå›´å®šä¹‰
train_time_range = ["2010-01-01", "2020-04-30"]  # è®­ç»ƒé›†
val_time_range = ["2020-05-01", "2020-05-31"]    # éªŒè¯é›†
test_time_range = ["2020-06-01", "2020-06-30"]   # æµ‹è¯•é›†

# åˆ›å»ºæ—¶é—´æ©ç 
train_mask = (symbol_df.index >= train_start) & (symbol_df.index <= train_end)
val_mask = (symbol_df.index >= val_start) & (symbol_df.index <= val_end)
test_mask = (symbol_df.index >= test_start) & (symbol_df.index <= test_end)
```

## ğŸ“Š æ•°æ®æ ¼å¼è¯´æ˜

### è¾“å…¥æ•°æ®æ ¼å¼ï¼ˆakshareåŸå§‹æ•°æ®ï¼‰

```
åˆ—åï¼š['æ—¥æœŸ', 'å¼€ç›˜', 'æ”¶ç›˜', 'æœ€é«˜', 'æœ€ä½', 'æˆäº¤é‡', 'æˆäº¤é¢', 'æŒ¯å¹…', 'æ¶¨è·Œå¹…', 'æ¶¨è·Œé¢', 'æ¢æ‰‹ç‡']
æ•°æ®ç±»å‹ï¼šDataFrame
ç´¢å¼•ï¼šæ•´æ•°ç´¢å¼•
ç¤ºä¾‹ï¼š
        æ—¥æœŸ    å¼€ç›˜    æ”¶ç›˜    æœ€é«˜    æœ€ä½   æˆäº¤é‡        æˆäº¤é¢
0  2020-01-02  12.20  12.05  12.25  11.98  1234567  1.52e+08
1  2020-01-03  12.05  12.15  12.30  12.00  1345678  1.63e+08
```

### è¾“å‡ºæ•°æ®æ ¼å¼ï¼ˆå¤„ç†åï¼‰

```
åˆ—åï¼š['open', 'high', 'low', 'close', 'vol', 'amt']
æ•°æ®ç±»å‹ï¼šDataFrame
ç´¢å¼•ï¼šDatetimeIndex
ç¤ºä¾‹ï¼š
            open   high    low  close      vol         amt
datetime                                                  
2020-01-02  12.20  12.25  11.98  12.05  1234567  1.52e+08
2020-01-03  12.05  12.30  12.00  12.15  1345678  1.63e+08
```

### ä¿å­˜æ ¼å¼

#### ç®€åŒ–ç‰ˆè¾“å‡º

```python
# processed_data_akshare_simple.pkl
[
    {
        'symbol': 'SH600000',
        'data': DataFrame  # åŒ…å«å¤„ç†åçš„è‚¡ç¥¨æ•°æ®
    },
    {
        'symbol': 'SH600009', 
        'data': DataFrame
    },
    ...
]
```

#### å®Œæ•´ç‰ˆè¾“å‡º

```python
# train_data.pkl, val_data.pkl, test_data.pkl
{
    'SH600000': DataFrame,  # è‚¡ç¥¨ä»£ç  -> å¯¹åº”æ—¶é—´æ®µçš„æ•°æ®
    'SH600009': DataFrame,
    'SH600010': DataFrame,
    ...
}
```

## âš ï¸ å¼‚å¸¸å¤„ç†

### ç½‘ç»œå¼‚å¸¸å¤„ç†

```python
# é‡è¯•æœºåˆ¶
for attempt in range(max_retries):
    try:
        stock_data = ak.stock_zh_a_hist(...)
        break  # æˆåŠŸåˆ™è·³å‡ºå¾ªç¯
    except Exception as e:
        if attempt < max_retries - 1:
            time.sleep(3)  # ç­‰å¾…3ç§’åé‡è¯•
        else:
            logger.error(f"æœ€ç»ˆå¤±è´¥: {str(e)}")
            return None
```

### æ•°æ®è´¨é‡æ£€æŸ¥

```python
# 1. ç©ºæ•°æ®æ£€æŸ¥
if stock_data is None or stock_data.empty:
    logger.warning(f"è‚¡ç¥¨ {symbol} è¿”å›ç©ºæ•°æ®")
    return None

# 2. å¿…è¦åˆ—æ£€æŸ¥
required_columns = ['æ—¥æœŸ', 'å¼€ç›˜', 'æ”¶ç›˜', 'æœ€é«˜', 'æœ€ä½', 'æˆäº¤é‡']
missing_cols = [col for col in required_columns if col not in stock_data.columns]
if missing_cols:
    logger.error(f"ç¼ºå°‘å¿…è¦åˆ—: {missing_cols}")
    return None

# 3. æ•°æ®é•¿åº¦æ£€æŸ¥
min_required_length = lookback_window + predict_window + 1
if len(stock_df) < min_required_length:
    logger.warning(f"æ•°æ®é•¿åº¦ä¸è¶³: {len(stock_df)} < {min_required_length}")
    continue
```

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

| é”™è¯¯ç±»å‹ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|----------|----------|----------|
| ç½‘ç»œè¿æ¥è¶…æ—¶ | ç½‘ç»œä¸ç¨³å®š | å¢åŠ é‡è¯•æ¬¡æ•°ï¼Œæ£€æŸ¥ç½‘ç»œè¿æ¥ |
| è‚¡ç¥¨ä»£ç æ— æ•ˆ | ä»£ç æ ¼å¼é”™è¯¯ | ä½¿ç”¨6ä½æ•°å­—æ ¼å¼ï¼ˆå¦‚600000ï¼‰ |
| æ•°æ®ä¸ºç©º | æ—¶é—´èŒƒå›´æ— äº¤æ˜“æ—¥ | æ£€æŸ¥æ—¶é—´èŒƒå›´ï¼Œé¿å¼€èŠ‚å‡æ—¥ |
| å†…å­˜ä¸è¶³ | æ•°æ®é‡è¿‡å¤§ | å‡å°‘è‚¡ç¥¨æ•°é‡æˆ–ç¼©çŸ­æ—¶é—´èŒƒå›´ |

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. æ‰¹é‡å¤„ç†ä¼˜åŒ–

```python
# ä½¿ç”¨tqdmæ˜¾ç¤ºè¿›åº¦
for i in trange(len(symbol_list), desc="å¤„ç†è‚¡ç¥¨æ•°æ®"):
    # å¤„ç†å•ä¸ªè‚¡ç¥¨
    process_single_stock(symbol_list[i])
```

### 2. å†…å­˜ç®¡ç†

```python
# åŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„æ•°æ®
stock_df = stock_df.dropna()  # æ¸…ç†ç¼ºå¤±å€¼
del original_data  # åˆ é™¤åŸå§‹æ•°æ®å¼•ç”¨
```

### 3. ç¼“å­˜æœºåˆ¶

```python
# ä¿å­˜ä¸­é—´ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—
with open('intermediate_results.pkl', 'wb') as f:
    pickle.dump(processed_data, f)
```

### æ€§èƒ½åŸºå‡†

| æ•°æ®è§„æ¨¡ | å¤„ç†æ—¶é—´ | å†…å­˜ä½¿ç”¨ |
|----------|----------|----------|
| 3è‚¡ç¥¨Ã—3ä¸ªæœˆ | 2-5åˆ†é’Ÿ | <500MB |
| 5è‚¡ç¥¨Ã—1å¹´ | 5-10åˆ†é’Ÿ | <1GB |
| 10è‚¡ç¥¨Ã—5å¹´ | 15-30åˆ†é’Ÿ | <2GB |

## â“ å¸¸è§é—®é¢˜

### Q1: akshareæ•°æ®è·å–å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A:** 
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. ç¡®è®¤è‚¡ç¥¨ä»£ç æ ¼å¼ï¼ˆ6ä½æ•°å­—ï¼‰
3. æ£€æŸ¥æ—¶é—´èŒƒå›´æ˜¯å¦åˆç†
4. å°è¯•å‡å°‘å¹¶å‘è¯·æ±‚

```python
# æµ‹è¯•akshareè¿æ¥
import akshare as ak
test_data = ak.stock_zh_a_hist(symbol="600000", period="daily", 
                               start_date="20200101", end_date="20200110")
print(test_data.head())
```

### Q2: æ•°æ®æ ¼å¼ä¸qlibä¸ä¸€è‡´ï¼Ÿ

**A:** 
1. æ£€æŸ¥ç‰¹å¾åˆ—åæ˜¯å¦æ­£ç¡®
2. ç¡®è®¤æ—¶é—´ç´¢å¼•æ ¼å¼
3. éªŒè¯æ•°æ®ç±»å‹è½¬æ¢

```python
# éªŒè¯æ•°æ®æ ¼å¼
print("åˆ—å:", list(df.columns))
print("ç´¢å¼•ç±»å‹:", type(df.index))
print("æ•°æ®ç±»å‹:", df.dtypes)
```

### Q3: å¤„ç†é€Ÿåº¦å¤ªæ…¢ï¼Ÿ

**A:** 
1. å‡å°‘è‚¡ç¥¨æ•°é‡
2. ç¼©çŸ­æ—¶é—´èŒƒå›´
3. ä½¿ç”¨ç®€åŒ–ç‰ˆå¤„ç†å™¨
4. å¢åŠ ç½‘ç»œé‡è¯•é—´éš”

### Q4: å†…å­˜ä¸è¶³ï¼Ÿ

**A:** 
1. åˆ†æ‰¹å¤„ç†è‚¡ç¥¨
2. åŠæ—¶é‡Šæ”¾å†…å­˜
3. ä½¿ç”¨æ›´å°çš„æ—¶é—´çª—å£

```python
# åˆ†æ‰¹å¤„ç†ç¤ºä¾‹
batch_size = 5
for i in range(0, len(symbols), batch_size):
    batch_symbols = symbols[i:i+batch_size]
    process_batch(batch_symbols)
```

### Q5: å¦‚ä½•æ·»åŠ æ–°çš„æŠ€æœ¯æŒ‡æ ‡ï¼Ÿ

**A:** åœ¨`calculate_derived_features`æ–¹æ³•ä¸­æ·»åŠ ï¼š

```python
def calculate_derived_features(self, df):
    result_df = df.copy()
    
    # ç°æœ‰ç‰¹å¾
    result_df['vol'] = result_df['volume']
    result_df['amt'] = ...
    
    # æ–°å¢æŠ€æœ¯æŒ‡æ ‡
    result_df['ma5'] = result_df['close'].rolling(5).mean()  # 5æ—¥å‡çº¿
    result_df['rsi'] = calculate_rsi(result_df['close'])     # RSIæŒ‡æ ‡
    
    # æ›´æ–°ç‰¹å¾åˆ—è¡¨
    self.feature_list.extend(['ma5', 'rsi'])
    
    return result_df[self.feature_list]
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼š`akshare_data_preprocess.log`
2. è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š`python test_akshare_vs_qlib.py`
3. æ£€æŸ¥ä¾èµ–ç‰ˆæœ¬ï¼š`pip list | grep akshare`
4. å‚è€ƒakshareå®˜æ–¹æ–‡æ¡£ï¼šhttps://akshare.akfamily.xyz/

---

**æ³¨æ„äº‹é¡¹ï¼š**
- akshareæ•°æ®æ¥æºäºå…¬å¼€å¸‚åœºï¼Œè¯·éµå®ˆç›¸å…³ä½¿ç”¨æ¡æ¬¾
- å»ºè®®åœ¨éäº¤æ˜“æ—¶é—´è¿›è¡Œå¤§é‡æ•°æ®è·å–
- æ•°æ®ä»…ä¾›ç ”ç©¶å’Œå­¦ä¹ ä½¿ç”¨ï¼ŒæŠ•èµ„æœ‰é£é™©