version: '3.8'

services:
  pos-handler:
    image: 192.168.9.20:8500/go-runtime:alpine 
    container_name: pos-handler
    working_dir: /app
    
    # 启动命令：复制挂载的二进制到容器可执行目录后运行（规避noexec）
    command: ["/bin/sh", "-c", "cp /app/run /tmp/run && chmod +x /tmp/run && exec /tmp/run"]

    # 挂载宿主机文件和目录
    volumes:
      - ../postgres-handler/run:/app/run:ro          # 可执行文件（只读）

    # 环境变量（可从 .env 文件加载，也可在这里覆盖）
    environment:
      - TZ=Asia/Shanghai
      - PORT=8080

    # 端口映射
    ports:
      - "58005:8080"

    # # 健康检查
    # healthcheck:
    #   test: ["CMD", "curl", "-f", "http://localhost:$${PORT:-8080}/health"]
    #   interval: 30s
    #   timeout: 10s
    #   start_period: 5s
    #   retries: 3
