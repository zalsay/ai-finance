# Exchange Calendars åº“é›†æˆæ€»ç»“

## æ¦‚è¿°

æˆåŠŸé›†æˆäº† `exchange_calendars` åº“æ¥å¤„ç†ä¸­å›½è‚¡å¸‚çš„äº¤æ˜“æ—¥å†ï¼Œæ˜¾è‘—æå‡äº†è‚¡ç¥¨é¢„æµ‹ç¨‹åºå¤„ç†éäº¤æ˜“æ—¥çš„å‡†ç¡®æ€§ã€‚

## é—®é¢˜èƒŒæ™¯

### åŸæœ‰é—®é¢˜
1. **ç®€å•æ—¥æœŸäº¤é›†**ï¼šä¹‹å‰ä½¿ç”¨ç®€å•çš„æ—¥æœŸäº¤é›†æ¥åŒ¹é…é¢„æµ‹æ•°æ®å’Œå®é™…æ•°æ®
2. **å‘¨æœ«å¤„ç†ä¸å‡†ç¡®**ï¼šæ— æ³•å‡†ç¡®è¯†åˆ«å’Œå¤„ç†å‘¨æœ«åŠèŠ‚å‡æ—¥
3. **æ•°æ®å¯¹é½é”™è¯¯**ï¼šé¢„æµ‹æ•°æ®åŒ…å«å‘¨æœ«ï¼Œè€Œè‚¡ç¥¨æ•°æ®åªæœ‰äº¤æ˜“æ—¥ï¼Œå¯¼è‡´æ•°æ®é”™ä½

### å…·ä½“è¡¨ç°
- é¢„æµ‹æ•°æ®ï¼š15å¤©ï¼ˆåŒ…å«4ä¸ªå‘¨æœ«ï¼‰
- å®é™…æ•°æ®ï¼š11ä¸ªäº¤æ˜“æ—¥
- ç»“æœï¼šæ•°æ®é•¿åº¦ä¸åŒ¹é…ï¼Œé¢„æµ‹å‡†ç¡®æ€§å—å½±å“

## è§£å†³æ–¹æ¡ˆ

### 1. å®‰è£… Exchange Calendars åº“

```bash
pip install exchange_calendars
```

### 2. æ ¸å¿ƒåŠŸèƒ½å®ç°

#### è·å–äº¤æ˜“æ—¥å†å‡½æ•°

```python
def get_trading_days(start_date, end_date):
    """
    ä½¿ç”¨exchange_calendarsè·å–ä¸­å›½è‚¡å¸‚çš„äº¤æ˜“æ—¥
    """
    try:
        # è·å–ä¸­å›½è‚¡å¸‚æ—¥å†ï¼ˆä¸Šæµ·è¯åˆ¸äº¤æ˜“æ‰€ï¼‰
        china_calendar = xcals.get_calendar('XSHG')
        
        # è·å–äº¤æ˜“æ—¥
        trading_days = china_calendar.sessions_in_range(
            start_date.strftime('%Y-%m-%d'),
            end_date.strftime('%Y-%m-%d')
        )
        
        return [date.date() for date in trading_days]
        
    except Exception as e:
        # å›é€€æ–¹æ¡ˆï¼šç®€å•çš„å·¥ä½œæ—¥è¿‡æ»¤
        date_range = pd.date_range(start=start_date, end=end_date, freq='D')
        return [d.date() for d in date_range if d.weekday() < 5]
```

#### æ•°æ®è¿‡æ»¤å‡½æ•°

```python
def filter_trading_days_data(df, date_column='ds'):
    """
    ä½¿ç”¨äº¤æ˜“æ—¥å†è¿‡æ»¤æ•°æ®ï¼Œåªä¿ç•™çœŸæ­£çš„äº¤æ˜“æ—¥
    """
    # è·å–æ•°æ®çš„æ—¥æœŸèŒƒå›´
    start_date = df[date_column].min()
    end_date = df[date_column].max()
    
    # è·å–äº¤æ˜“æ—¥
    trading_days = get_trading_days(start_date, end_date)
    
    # è¿‡æ»¤æ•°æ®ï¼Œåªä¿ç•™äº¤æ˜“æ—¥
    df_filtered = df[df[date_column].dt.date.isin(trading_days)]
    
    return df_filtered
```

### 3. é›†æˆåˆ°ä¸»ç¨‹åº

#### ä¿®æ”¹é¢„æµ‹å¯¹æ¯”å‡½æ•°

```python
def plot_forecast_vs_actual(forecast_df, df_test, stock_code):
    # ä½¿ç”¨äº¤æ˜“æ—¥å†è¿‡æ»¤é¢„æµ‹æ•°æ®
    stock_forecast_filtered = filter_trading_days_data(stock_forecast, 'ds')
    
    # ä½¿ç”¨äº¤æ˜“æ—¥å†è¿‡æ»¤å®é™…æ•°æ®
    stock_test_filtered = filter_trading_days_data(stock_test, 'ds')
    
    # æ‰¾åˆ°å…±åŒäº¤æ˜“æ—¥
    forecast_dates = set(stock_forecast_filtered['ds'].dt.date)
    actual_dates = set(stock_test_filtered['ds'].dt.date)
    common_dates = forecast_dates.intersection(actual_dates)
```

## å®æ–½æ•ˆæœ

### 1. æ•°æ®å¤„ç†æ”¹è¿›

**æµ‹è¯•æœŸé—´ï¼š2023-09-08 åˆ° 2023-09-22**

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å |
|------|--------|--------|
| é¢„æµ‹æ•°æ®åŸå§‹é•¿åº¦ | 15å¤© | 15å¤© |
| å®é™…äº¤æ˜“æ—¥è¯†åˆ« | ç®€å•äº¤é›† | ç²¾ç¡®è¯†åˆ« |
| è¿‡æ»¤åé¢„æµ‹æ•°æ® | 11å¤©ï¼ˆä¸å‡†ç¡®ï¼‰ | 11å¤©ï¼ˆç²¾ç¡®ï¼‰ |
| éäº¤æ˜“æ—¥è¿‡æ»¤ | ä¸å®Œæ•´ | 4ä¸ªå‘¨æœ«å‡†ç¡®è¿‡æ»¤ |

### 2. äº¤æ˜“æ—¥å†å‡†ç¡®æ€§

**æ­£ç¡®è¯†åˆ«çš„äº¤æ˜“æ—¥ï¼ˆ11å¤©ï¼‰ï¼š**
1. 2023-09-08 (Friday)
2. 2023-09-11 (Monday)
3. 2023-09-12 (Tuesday)
4. 2023-09-13 (Wednesday)
5. 2023-09-14 (Thursday)
6. 2023-09-15 (Friday)
7. 2023-09-18 (Monday)
8. 2023-09-19 (Tuesday)
9. 2023-09-20 (Wednesday)
10. 2023-09-21 (Thursday)
11. 2023-09-22 (Friday)

**æ­£ç¡®è¿‡æ»¤çš„éäº¤æ˜“æ—¥ï¼ˆ4å¤©ï¼‰ï¼š**
- 2023-09-09 (Saturday)
- 2023-09-10 (Sunday)
- 2023-09-16 (Saturday)
- 2023-09-17 (Sunday)

### 3. é¢„æµ‹æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| MSE | 0.1824 | å‡æ–¹è¯¯å·® |
| MAE | 0.3934 | å¹³å‡ç»å¯¹è¯¯å·® |
| æ•°æ®åŒ¹é…ç‡ | 100% | æ‰€æœ‰äº¤æ˜“æ—¥å®Œç¾åŒ¹é… |

## æŠ€æœ¯ä¼˜åŠ¿

### 1. ä¸“ä¸šæ€§
- **å®˜æ–¹äº¤æ˜“æ—¥å†**ï¼šä½¿ç”¨ä¸Šæµ·è¯åˆ¸äº¤æ˜“æ‰€ï¼ˆXSHGï¼‰çš„å®˜æ–¹äº¤æ˜“æ—¥å†
- **èŠ‚å‡æ—¥æ”¯æŒ**ï¼šè‡ªåŠ¨å¤„ç†ä¸­å›½çš„æ³•å®šèŠ‚å‡æ—¥
- **å®æ—¶æ›´æ–°**ï¼šäº¤æ˜“æ—¥å†æ•°æ®ä¼šè‡ªåŠ¨æ›´æ–°

### 2. å¯é æ€§
- **é”™è¯¯å¤„ç†**ï¼šåŒ…å«å›é€€æœºåˆ¶ï¼Œç¡®ä¿ç¨‹åºç¨³å®šè¿è¡Œ
- **æ•°æ®éªŒè¯**ï¼šè¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼Œä¾¿äºè°ƒè¯•å’ŒéªŒè¯
- **å…¼å®¹æ€§**ï¼šä¸ç°æœ‰ä»£ç å®Œç¾é›†æˆ

### 3. æ‰©å±•æ€§
- **å¤šå¸‚åœºæ”¯æŒ**ï¼šå¯è½»æ¾æ‰©å±•åˆ°å…¶ä»–å¸‚åœºï¼ˆå¦‚æ·±äº¤æ‰€ XSHEï¼‰
- **çµæ´»é…ç½®**ï¼šæ”¯æŒè‡ªå®šä¹‰æ—¥æœŸèŒƒå›´å’Œè¿‡æ»¤æ¡ä»¶
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šç‹¬ç«‹çš„å‡½æ•°ï¼Œä¾¿äºå¤ç”¨å’Œæµ‹è¯•

## ä»£ç æ”¹è¿›ç‚¹

### 1. å¯¼å…¥è¯­å¥
```python
import exchange_calendars as xcals
from datetime import datetime, timedelta
```

### 2. æ–°å¢å‡½æ•°
- `get_trading_days()`: è·å–äº¤æ˜“æ—¥åˆ—è¡¨
- `filter_trading_days_data()`: è¿‡æ»¤äº¤æ˜“æ—¥æ•°æ®

### 3. ä¿®æ”¹å‡½æ•°
- `plot_forecast_vs_actual()`: ä½¿ç”¨æ–°çš„äº¤æ˜“æ—¥è¿‡æ»¤é€»è¾‘
- `integrate_with_timesfm_forecast()`: é›†æˆäº¤æ˜“æ—¥å†å¤„ç†

## æµ‹è¯•éªŒè¯

### æµ‹è¯•è„šæœ¬
åˆ›å»ºäº†ä¸“é—¨çš„æµ‹è¯•è„šæœ¬ `test_exchange_calendars.py`ï¼ŒéªŒè¯ï¼š
- äº¤æ˜“æ—¥å†è·å–åŠŸèƒ½
- æ•°æ®è¿‡æ»¤å‡†ç¡®æ€§
- å‘¨æœ«å’ŒèŠ‚å‡æ—¥è¯†åˆ«

### æµ‹è¯•ç»“æœ
```
âœ… åŸºæœ¬åŠŸèƒ½æµ‹è¯•: é€šè¿‡
âœ… æ•°æ®è¿‡æ»¤æµ‹è¯•: é€šè¿‡
ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼exchange_calendarsåº“å·¥ä½œæ­£å¸¸
```

## æœªæ¥æ”¹è¿›æ–¹å‘

### 1. å¤šå¸‚åœºæ”¯æŒ
- æ”¯æŒæ·±åœ³è¯åˆ¸äº¤æ˜“æ‰€ï¼ˆXSHEï¼‰
- æ”¯æŒæ¸¯è‚¡ã€ç¾è‚¡ç­‰å…¶ä»–å¸‚åœº

### 2. ç¼“å­˜ä¼˜åŒ–
- ç¼“å­˜äº¤æ˜“æ—¥å†æ•°æ®ï¼Œæé«˜æ€§èƒ½
- å‡å°‘é‡å¤çš„APIè°ƒç”¨

### 3. é…ç½®åŒ–
- æ”¯æŒé…ç½®æ–‡ä»¶æŒ‡å®šäº¤æ˜“æ‰€
- æ”¯æŒè‡ªå®šä¹‰èŠ‚å‡æ—¥è§„åˆ™

## æ€»ç»“

é€šè¿‡é›†æˆ `exchange_calendars` åº“ï¼Œæˆ‘ä»¬æˆåŠŸè§£å†³äº†è‚¡ç¥¨é¢„æµ‹ç¨‹åºä¸­çš„éäº¤æ˜“æ—¥å¤„ç†é—®é¢˜ï¼š

1. **å‡†ç¡®æ€§æå‡**ï¼šç²¾ç¡®è¯†åˆ«äº¤æ˜“æ—¥å’Œéäº¤æ˜“æ—¥
2. **æ•°æ®è´¨é‡æ”¹å–„**ï¼šç¡®ä¿é¢„æµ‹æ•°æ®å’Œå®é™…æ•°æ®åœ¨ç›¸åŒçš„äº¤æ˜“æ—¥è¿›è¡Œæ¯”è¾ƒ
3. **ç¨‹åºç¨³å®šæ€§å¢å¼º**ï¼šåŒ…å«é”™è¯¯å¤„ç†å’Œå›é€€æœºåˆ¶
4. **å¯ç»´æŠ¤æ€§æé«˜**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºæµ‹è¯•å’Œæ‰©å±•

è¿™ä¸€æ”¹è¿›ä¸ºè‚¡ç¥¨é¢„æµ‹æ¨¡å‹æä¾›äº†æ›´å¯é çš„æ•°æ®åŸºç¡€ï¼Œæœ‰åŠ©äºæé«˜é¢„æµ‹çš„å‡†ç¡®æ€§å’Œå®ç”¨æ€§ã€‚